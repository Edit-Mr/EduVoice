<!-- @format -->

<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <%- include("partials/meta") %>
        <title><%= ruleData.name %> | 學聲 EduVoice</title>
        <style>
            main {
                padding-top: 5rem;
                transition: all 0.5s;
            }
            .intro-container {
                display: flex;
                gap: 2rem;
            }
            .intro {
                flex-grow: 1;
            }
            .box {
                background-color: #fff;
                border-radius: 1rem;
                padding: 24px;
                flex-grow: 1;
            }
            .pie-chart {
                flex: 0 0;
                display: flex;
                flex-direction: column;
                white-space: nowrap;
            }
            .pie-box {
                display: flex;
                justify-content: center;
                align-items: center;
                flex-grow: 1;
                min-width: 14rem;
                gap: 2rem;
            }
            .pie {
                width: 10rem;
                height: 10rem;
                border-radius: 50%;
                /* background: conic-gradient(
                    #f00 0% 20%,
                    rgb(163, 163, 163) 20% 30%,
                    #ff0 30% 60%,
                    #0f0 60% 100%
                ); */
            }
            .pie.lol {
                background: conic-gradient(
                    rgb(163, 163, 163) 0% 10%,
                    #ff0 10% 30%,
                    #0f0 30% 100%
                );
            }

            .school-status {
                display: flex;
                flex-wrap: wrap;
                gap: 2rem;
            }
            .school-status > div {
                flex: 1;
            }
            .school-status h2 {
                text-align: center;
            }
            .school-status span {
                text-align: right;
            }
            .school-status a {
                display: flex;
                justify-content: space-between;
                padding: 1rem;
                border-radius: 0.375rem;
                background-color: #f0f0f0;
                margin-bottom: 0.5rem;
                text-decoration: none;
                color: #000;
            }
        </style>
    </head>

    <body class="aemfont-GenWanMin">
        <%- include ("partials/nav") %>
        <main>
            <section>
                <h1><%= schoolData.name %></h1>
                <p><%= schoolData.location %></p>
            </section>
            <section class="intro-container">
                <div class="intro box">
                    <h2>校園簡介</h2>
                    <p>
                        <%= schoolData.intro %>
                    </p>
                </div>
                <div class="pie-chart box">
                    <h2>遵守法規</h2>
                    <div class="pie-box">
                        <!-- 這一塊派不確定要統計什麼 -->
                        <div class="pie lol"></div>
                        <div>
                            <div class="green pie-square"></div>
                            已實施： 30% <br />
                            <div class="yellow pie-square"></div>
                            實驗中： 10% <br />
                            <div class="red pie-square"></div>
                            未實施 ： 50%<br />
                            <div class="red pie-square"></div>
                            未知: 10%
                        </div>
                    </div>
                </div>
                <div class="pie-chart box">
                    <h2>所有政策</h2>
                    <div class="pie-box">
                        <div class="pie" id="allPolicies"></div>
                        <div>
                            <div class="green pie-square" ></div>
                            <span id="implemented">已實施 ：</span>
                            <br/>
                            <div class="yellow pie-square"></div>
                            <span id="Testing">實驗中 ：</span>
                            <br />
                            <div class="red pie-square"></div>
                            <span  id="notYet">未實施 ：</span>
                        </div>
                    </div>
                </div>
            </section>
            <% 
            let countDone = 0, countNotYet = 0, countTesting = 0;
            %>
            <section class="school-status">
                <div>
                    <h2>已實施</h2>
                    <% if (ruleData && ruleData.length > 0) { %>
                        
                        <% ruleData.forEach(rule => { %>
                                <%if (rule.status == "O") { %>
                                    <%countDone++;%>
                                    <a href="/i/<%= rule.id %>"><%= rule.title %> <span>✅</span></a>
                            <% }}); %>
                    <% } else { %>
                        <p>目前沒有資料</p>
                    <% } %>
                </div>
                <div>
                    <h2>實驗階段 / 半開放</h2>
                    <% if (ruleData && ruleData.length > 0) { %>
                        
                        <% ruleData.forEach(rule => { %>
                                <%if (rule.status == "?") { %>
                                    <%countTesting++;%>
                                    <!-- <a onclick="alert('更新紀錄\n❌2023.1.1 糾察隊門口登記 (學生)\n🟡 2024.1.1 登記不懲處 (老師)')">穿便服上學 <span>🟡</span></a> -->
                                    <a href="/i/<%= rule.id %>"><%= rule.title %> <span>🟡</span></a>
                            <% }}); %>
                    <% } else { %>
                        <p>目前沒有資料</p>
                    <% } %>
                </div>
                <div>
                    <h2>未實施</h2>
                    <% if (ruleData && ruleData.length > 0) { %>
                        
                        <% ruleData.forEach(rule => { %>
                                <%if (rule.status == "X") { %>
                                    <%countNotYet++;%>
                                    <a href="/i/<%= rule.id %>"><%= rule.title %> <span>❌</span></a>
                            <% }}); %>
                    <% } else { %>
                        <p>目前沒有資料</p>
                    <% } %>
                </div>
                <% const totalCount = countDone + countNotYet + countTesting;%>
            </section>
        </main>
        <%
            const Red= ((countNotYet / totalCount) * 100).toFixed(0);
            const yellow= ((countTesting / totalCount) * 100).toFixed(0);
            const green = ((countDone / totalCount) * 100).toFixed(0);
            const pieFalg = totalCount == 0 ? false : true;//表示是否有資料
        %>
        <script>
            let pieRed =0;
            //不用管 VSC 的紅色波浪線，這是 EJS 的語法，不是 JS 的語法
            if(<%= pieFalg %>){
                document.getElementById('allPolicies').style.background = `conic-gradient(
                        #f00 0% <%- Red %>%,
                        #ff0 <%- Red %>% <%- Red+yellow %>%,
                        #0f0 <%- Red+yellow %>% 100%
                    )`;
                document.getElementById('notYet').innerText += ` <%- Red %>%`;
                document.getElementById('Testing').innerText += ` <%- yellow %>%`;
                document.getElementById('implemented').innerText += ` <%- green %>%`;
                console.log('red:',<%- Red %>)
            }
            else
            {
                
                document.getElementById('allPolicies').style.background = `conic-gradient(
                        #cfcfcc 0% 100%
                    )`;
                document.getElementById('notYet').innerText ="沒有資料"
                document.getElementById('Testing').innerText="沒有資料"
                document.getElementById('implemented').innerText ="沒有資料"
            }
          </script> 
        <%- include("partials/footer") %>
    </body>
</html>
